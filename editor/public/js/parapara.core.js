function UUID(){}Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var ParaPara=ParaPara||{};ParaPara.SVG_NS=ParaPara.SVG_NS||"http://www.w3.org/2000/svg",ParaPara.XLINK_NS=ParaPara.XLINK_NS||"http://www.w3.org/1999/xlink","function"!=typeof ParaPara.fixPrecision&&(ParaPara.fixPrecision=function(a){return a.toFixed(2)}),ParaPara.EraseControls=function(){this.eraser=null,this.currentTouch=null,this.frame=null,this.brushWidth=void 0,this.prevX=void 0,this.prevY=void 0,this.mouseDownHandler=this.mouseDown.bind(this),this.mouseMoveHandler=this.mouseMove.bind(this),this.mouseUpHandler=this.mouseUp.bind(this),this.touchStartHandler=this.touchStart.bind(this),this.touchMoveHandler=this.touchMove.bind(this),this.touchEndHandler=this.touchEnd.bind(this),this.touchCancelHandler=this.touchEnd.bind(this),void 0===ParaPara.erasePrecision&&(ParaPara.erasePrecision=1)},ParaPara.EraseControls.prototype.targetFrame=function(a){console.assert(!this.eraser,"Already erasing?"),this.frame=a,this.brushWidth=10,ParaPara.svgRoot.addEventListener("mousedown",this.mouseDownHandler),ParaPara.svgRoot.addEventListener("mousemove",this.mouseMoveHandler),ParaPara.svgRoot.addEventListener("mouseup",this.mouseUpHandler),ParaPara.svgRoot.addEventListener("touchstart",this.touchStartHandler),ParaPara.svgRoot.addEventListener("touchmove",this.touchMoveHandler),ParaPara.svgRoot.addEventListener("touchend",this.touchEndHandler),ParaPara.svgRoot.addEventListener("touchcancel",this.touchCancelHandler),this.prevX=void 0,this.prevY=void 0},ParaPara.EraseControls.prototype.disable=function(){ParaPara.svgRoot.removeEventListener("mousedown",this.mouseDownHandler),ParaPara.svgRoot.removeEventListener("mousemove",this.mouseMoveHandler),ParaPara.svgRoot.removeEventListener("mouseup",this.mouseUpHandler),ParaPara.svgRoot.removeEventListener("touchstart",this.touchStartHandler),ParaPara.svgRoot.removeEventListener("touchmove",this.touchMoveHandler),ParaPara.svgRoot.removeEventListener("touchend",this.touchEndHandler),ParaPara.svgRoot.removeEventListener("touchcancel",this.touchCancelHandler)},ParaPara.EraseControls.prototype.setBrushWidth=function(a){this.brushWidth=a},ParaPara.EraseControls.prototype.mouseDown=function(a){a.preventDefault(),this.eraser||(ParaPara.history.add("update",ParaPara.frames.getCurrentIndex()),this.eraser=new ParaPara.Eraser(this.frame,this.brushWidth),this.eraseFromEvent(a))},ParaPara.EraseControls.prototype.mouseMove=function(a){a.preventDefault(),this.eraser&&this.eraseFromEvent(a)},ParaPara.EraseControls.prototype.mouseUp=function(a){a.preventDefault(),this.eraser&&(this.eraser=null,this.prevX=this.prevY=void 0,ParaPara.notifyGraphicChanged())},ParaPara.EraseControls.prototype.touchStart=function(a){a.preventDefault(),this.eraser||(ParaPara.history.add("update",ParaPara.frames.getCurrentIndex()),this.currentTouch=a.changedTouches[0].identifier,this.eraser=new ParaPara.Eraser(this.frame,this.brushWidth),this.eraseFromEvent(a))},ParaPara.EraseControls.prototype.touchMove=function(a){a.preventDefault(),this.eraser&&this.eraseFromEvent(a)},ParaPara.EraseControls.prototype.touchEnd=function(a){if(a.preventDefault(),this.eraser){for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b];if(c.identifier==this.currentTouch){this.currentTouch=null;break}}this.currentTouch||(this.eraser=null,this.prevX=this.prevY=void 0,ParaPara.notifyGraphicChanged())}},ParaPara.EraseControls.prototype.eraseFromEvent=function(a){console.assert(this.eraser,"No eraser to use");var b=this.getCoordsFromEvent(a);if(b){var c=[],d=this.getLocalCoords(b[0],b[1],this.frame);c=this.getCandidateShapes(d.x,d.y);for(var e=[],f=0;f<c.length;f++)e.push(c[f].id);this.eraser.erase(d.x,d.y,c),this.prevX=d.x,this.prevY=d.y}},ParaPara.EraseControls.prototype.getCoordsFromEvent=function(a){if(!a.changedTouches)return[a.clientX,a.clientY];for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b];if(c.identifier==this.currentTouch)return[c.clientX,c.clientY]}return null},ParaPara.EraseControls.prototype.getCandidateShapes=function(a,b){for(var c=this.frame.childNodes,d=[],e=c.length-1;e>=0;--e){var f=c[e];if(f.nodeType==Node.ELEMENT_NODE){var g=f.getBBox();g.x-=this.brushWidth/2,g.y-=this.brushWidth/2,g.width+=this.brushWidth,g.height+=this.brushWidth;var h=this.prevX?ParaPara.Geometry.lineIntersectsRect([this.prevX,this.prevY,a,b],g):ParaPara.Geometry.rectContainsPoint(g,[a,b]);h&&d.push(f)}}return d},ParaPara.EraseControls.prototype.getLocalCoords=function(a,b,c){var d=ParaPara.svgRoot.createSVGPoint();d.x=a,d.y=b;var e=c.parentNode.getScreenCTM();return d.matrixTransform(e.inverse())},ParaPara.Eraser=function(a,b){this.prevX=void 0,this.prevY=void 0,this.brushWidth=b,this.currentScale=a.getScreenCTM().a},ParaPara.Eraser.prototype.erase=function(a,b,c){for(var d=new ParaPara.Brush(this.prevX?[this.prevX,this.prevY,a,b]:[a,b]),e=this.brushWidth/this.currentScale,f=c.length,g=0;f>g;++g){var h=c[g];if("path"==h.tagName){var i=parseFloat(window.getComputedStyle(h,null).getPropertyValue("stroke-width",null)),j=e+i;d.setWidth(j),this.cutPath(d,h)}else"circle"==h.tagName?this.cutCircle(d,h):console.assert(!1,"Got unexpected shape type: "+h.tagName)}this.prevX=a,this.prevY=b},ParaPara.Eraser.prototype.cutPath=function(a,b){for(var c=b.pathSegList,d=void 0,e=!1,f=new Array,g=0;g<c.numberOfItems;++g){var h=c.getItem(g),i=this.getSegObject(h,d),j=i.cut(a);j!=i&&(e=!0),f=f.concat(j),d={x:h.x,y:h.y}}if(e)if(f=f.filter(ParaPara.Eraser.filterSuperfluousMoveTo),f.length){var k=f.join("");b.setAttribute("d",k)}else b.parentNode.removeChild(b);return e},ParaPara.Eraser.filterSuperfluousMoveTo=function(a,b,c){return a.constructor!=ParaPara.MoveToSegment?!0:b<c.length-1&&c[b+1].constructor!=ParaPara.MoveToSegment},ParaPara.Eraser.prototype.getSegObject=function(a,b){switch(a.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:return new ParaPara.MoveToSegment([a.x,a.y]);case SVGPathSeg.PATHSEG_LINETO_ABS:return new ParaPara.LineToSegment([b.x,b.y,a.x,a.y]);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:return new ParaPara.CurveToSegment([b.x,b.y,a.x1,a.y1,a.x2,a.y2,a.x,a.y]);default:console.assert(!1,"Unexpected path segment type: "+a.pathSegType)}},ParaPara.Eraser.prototype.cutCircle=function(a,b){b.parentNode.removeChild(b)},ParaPara.Brush=function(a){console.assert(a instanceof Array&&2==a.length||4==a.length,"Unexpected brush dimensions"),this.points=a,this.bbox=null,this.width=void 0,this.length=void 0,this.path=[],this.mx=null,this.angle=2==this.points.length?0:Math.atan2(this.points[3]-this.points[1],this.points[2]-this.points[0])},ParaPara.Brush.prototype.setWidth=function(a){if(this.width!=a){if(this.width=a,2==this.points.length){var b=this.width/Math.SQRT2/2;this.path=[this.points[0]-b,this.points[1]-b,this.points[0]+b,this.points[1]-b,this.points[0]+b,this.points[1]+b,this.points[0]-b,this.points[1]+b],this.length=2*b}else{var c=Math.cos(this.angle-Math.PI/2)*this.width/2,d=Math.sin(this.angle-Math.PI/2)*this.width/2,e=Math.cos(this.angle)*this.width/2,f=Math.sin(this.angle)*this.width/2;this.path=[],this.path.push(this.points[0]+c-e),this.path.push(this.points[1]+d-f),this.path.push(this.points[0]-c-e),this.path.push(this.points[1]-d-f),this.path.push(this.points[2]-c+e),this.path.push(this.points[3]-d+f),this.path.push(this.points[2]+c+e),this.path.push(this.points[3]+d+f),this.length=ParaPara.Geometry.lineLength(this.points[0],this.points[1],this.points[2],this.points[3])+this.width}this.bbox=null}},ParaPara.Brush.prototype.getDimensions=function(a){return 2==this.points.length?{width:this.length,length:this.length}:{width:this.width,length:this.length}},ParaPara.Brush.prototype.getBBox=function(a){if(this.bbox)return this.bbox;var b=Math.min(this.path[0],this.path[2],this.path[4],this.path[6]),c=Math.min(this.path[1],this.path[3],this.path[5],this.path[7]),d=Math.max(this.path[0],this.path[2],this.path[4],this.path[6]),e=Math.max(this.path[1],this.path[3],this.path[5],this.path[7]);return this.bbox={x:b,y:c,width:d-b,height:e-c},this.bbox},ParaPara.Brush.prototype.getTransform=function(){if(this.mx)return this.mx;if(2==this.points.length)this.mx=ParaPara.svgRoot.createSVGMatrix(),this.mx=this.mx.translate(-this.path[0],-this.path[1]);else{var a=180*this.angle/Math.PI;this.mx=ParaPara.svgRoot.createSVGMatrix(),this.mx=this.mx.rotate(-a,0,0),this.mx=this.mx.translate(-this.path[0],-this.path[1])}return this.mx},ParaPara.Brush.prototype.transformPoint=function(a){var b=this.getTransform();if(!b)return a.slice();var c=b.a*a[0]+b.c*a[1]+b.e,d=b.b*a[0]+b.d*a[1]+b.f;return[c,d]},ParaPara.Brush.prototype.transformPoints=function(a){var b=this.getTransform();if(!b)return a.slice();for(var c=[],d=0;d<a.length;d+=2){var e=this.transformPoint(a.slice(d,d+2));c.push(e[0],e[1])}return c},ParaPara.Geometry={},ParaPara.Geometry.linesIntersect=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3],k=(c*f-d*e)*(g-i)-(c-e)*(g*j-h*i),l=(c*f-d*e)*(h-j)-(d-f)*(g*j-h*i),m=(c-e)*(h-j)-(d-f)*(g-i);if(0==m)return null;var n=k/m,o=l/m;return[n,o]},ParaPara.Geometry.segmentsIntersect=function(a,b){var c=ParaPara.Geometry.isBetween,d=ParaPara.Geometry.linesIntersect(a,b);return d&&c(d[0],a[0],a[2])&&c(d[0],b[0],b[2])&&c(d[1],a[1],a[3])&&c(d[1],b[1],b[3])?d:null},ParaPara.Geometry.lineIntersectsRect=function(a,b){var c=[b.x,b.y,b.x+b.width,b.y,b.x+b.width,b.y+b.height,b.x,b.y+b.height];if(a[0]>=c[0]&&a[0]<=c[4]&&a[1]>=c[1]&&a[1]<=c[5]||a[2]>=c[0]&&a[2]<=c[4]&&a[3]>=c[1]&&a[3]<=c[5])return!0;for(var d=0;4>d;++d){var e=3>d?c.slice(2*d,2*d+4):c.slice(2*d,2*d+2).concat(c.slice(0,2));if(ParaPara.Geometry.segmentsIntersect(a,e))return!0}return!1},ParaPara.Geometry.intersectsWithZeroedRect=function(a,b,c){var d,e,f,g,h=[],i=(a[3]-a[1])/(a[2]-a[0]);if(a[0]<a[2]?(d=Math.max(0,a[0]),e=Math.min(b,a[2])):(d=Math.max(0,a[2]),e=Math.min(b,a[0])),d>=e)return h;if(a[1]<a[3]?(f=Math.max(0,a[1]),g=Math.min(c,a[3])):(f=Math.max(0,a[3]),g=Math.min(c,a[1])),f>=g)return h;for(var j=[0,b],k=0;i!=1/0&&k<j.length;++k){var l=j[k],m=i*(l-a[0])+a[1];l>=d&&e>=l&&m>=f&&g>=m&&h.push([l,m])}for(var n=[0,c],k=0;0!=i&&k<n.length;++k){var m=n[k],l=1/i*(m-a[1])+a[0];l>=d&&e>=l&&m>=f&&g>=m&&h.push([l,m])}return h},ParaPara.Geometry.rectsIntersect=function(a,b){return!(a.x+a.width<=b.x||a.x>=b.x+b.width||a.y+a.height<=b.y||a.y>=b.y+b.height)},ParaPara.Geometry.rectContainsRect=function(a,b){return b.x>=a.x&&b.x+b.width<=a.x+a.width&&b.y>=a.y&&b.y+b.height<=a.y+a.height},ParaPara.Geometry.rectContainsLine=function(a,b){var c=ParaPara.Geometry.rectContainsPoint;return c(a,[b[0],b[1]])&&c(a,[b[2],b[3]])},ParaPara.Geometry.rectContainsPoint=function(a,b){return a.x<=b[0]&&b[0]<=a.x+a.width&&a.y<=b[1]&&b[1]<=a.y+a.height},ParaPara.Geometry.lineLength=function(a,b,c,d){return Math.sqrt((c-=a)*c+(d-=b)*d)},ParaPara.Geometry.isBetween=function(a,b,c){var d=1e-6;return a>=Math.min(b,c)-d&&a<=Math.max(b,c)+d},ParaPara.Geometry.prettyMuchEqual=function(a,b){var c=1e-6;return Math.abs(a-b)<c},ParaPara.MoveToSegment=function(a){console.assert(a instanceof Array&&2==a.length,"Unexpected segment length"),this.point=a},ParaPara.MoveToSegment.prototype.cut=function(a){return this},ParaPara.MoveToSegment.prototype.toString=function(){return"M"+this.point.map(ParaPara.fixPrecision).join(" ")},ParaPara.LineToSegment=function(a){console.assert(a instanceof Array&&4==a.length,"Unexpected segment length"),this.points=a},ParaPara.LineToSegment.prototype.cut=function(a){var b=ParaPara.MoveToSegment,c=ParaPara.LineToSegment,d=ParaPara.Geometry.prettyMuchEqual,e=a.getBBox();if(!ParaPara.Geometry.lineIntersectsRect(this.points,e))return this;var f=a.transformPoints(this.points),g=a.getDimensions(),h={x:0,y:0,width:g.length,height:g.width};if(ParaPara.Geometry.rectContainsLine(h,f))return new b(this.points.slice(2));for(var i=[],j=0;4>j;++j){var k=3>j?a.path.slice(2*j,2*j+4):a.path.slice(2*j,2*j+2).concat(a.path.slice(0,2)),l=ParaPara.Geometry.segmentsIntersect(this.points,k);if(l){if(i.length&&d(l[0],i[i.length-2])&&d(l[1],i[i.length-1]))continue;if(i.push(l[0],l[1]),4==i.length)break}}if(!i.length)return this;if(4==i.length){var m,n;if(this.points[2]==this.points[0]?(m=3,n=1):(m=2,n=0),this.points[m]-this.points[n]<0!=i[m]-i[n]<0){var o=i.slice(0,2);i[0]=i[2],i[1]=i[3],i[2]=o[0],i[3]=o[1]}}for(var p=f[0]>=0&&f[0]<=g.length&&f[1]>=0&&f[1]<=g.width,q=[],r=this.points.slice(0,2).concat(i,this.points.slice(2)),j=0;j<r.length-2;j+=2)p?q.push(new b(r.slice(j+2,j+4))):q.push(new c(r.slice(j,j+4))),p=!p;return q},ParaPara.LineToSegment.prototype.toString=function(){return"L"+this.points.slice(2).map(ParaPara.fixPrecision).join(" ")},ParaPara.CurveToSegment=function(a){console.assert(a instanceof Array&&8==a.length,"Unexpected segment length"),this.points=a},ParaPara.CurveToSegment.prototype.cut=function(a){var b=ParaPara.MoveToSegment,c=ParaPara.CurveToSegment,d=ParaPara.Geometry.lineLength,e=(ParaPara.Geometry.segmentsIntersect,a.getBBox()),f=this.getBBox();if(!ParaPara.Geometry.rectsIntersect(e,f))return this;var g=new c(a.transformPoints(this.points)),h=a.getDimensions(),i={x:0,y:0,width:h.length,height:h.width},j=d(this.points[0],this.points[1],this.points[6],this.points[7]);if(j<.75*a.width){var k=[g.points[0],g.points[1],g.points[6],g.points[7]];return ParaPara.Geometry.intersectsWithZeroedRect(k,i)?new b(this.points.slice(6)):this}var l=g.getBBox();if(ParaPara.Geometry.rectContainsRect(i,l))return new b(this.points.slice(6));if(!ParaPara.Geometry.rectsIntersect(l,i))return this;for(var m=1/ParaPara.erasePrecision,n=g.getValue(0),o=[],p=n[0]>=0&&n[0]<=h.length&&n[1]>=0&&n[1]<=h.width,q=m;1>=q;q+=m){var r=g.getValue(q),s=ParaPara.Geometry.intersectsWithZeroedRect([n[0],n[1],r[0],r[1]],h.length,h.width);if(s.length)for(var t=d(n[0],n[1],r[0],r[1]),u=0;u<s.length;++u){var v=s[u];if(v[0]!=n[0]||v[1]!=n[1]){var w=d(n[0],n[1],v[0],v[1])/t,x=q-m+m*w;o.push(x)}}n=r}if(!o.length&&!p)return this;o.sort(function(a,b){return a-b});for(var y=p,z=[],A=this.points,B=0,u=0;u<o.length;++u){var q=o[u],C=(q-B)/(1-B),D=this.splitSegment(A,C);y?z.push(new b(D[0].slice(6))):z.push(new c(D[0])),A=D[1],y=!y,B=q}return y?z.push(new b(A.slice(6))):z.push(new c(A)),z},ParaPara.CurveToSegment.prototype.splitSegment=function(a,b){for(var c=[a[0],a[1]],d=[a[6],a[7]],e=a,f=[],g=3;g>=1;--g){f=[];for(var h=0;g>h;++h)f.push(e[2*h]*(1-b)+e[2*h+2]*b),f.push(e[2*h+1]*(1-b)+e[2*h+3]*b);c.push(f[0],f[1]),d.unshift(f[2*(g-1)],f[2*(g-1)+1]),e=f}return[c,d]},ParaPara.CurveToSegment.prototype.getValue=function(a){return[this.getX(a),this.getY(a)]},ParaPara.CurveToSegment.prototype.getX=function(a){return this.computeCubicBaseValue(a,this.points[0],this.points[2],this.points[4],this.points[6])},ParaPara.CurveToSegment.prototype.getY=function(a){return this.computeCubicBaseValue(a,this.points[1],this.points[3],this.points[5],this.points[7])},ParaPara.CurveToSegment.prototype.computeCubicBaseValue=function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e},ParaPara.CurveToSegment.prototype.getBBox=function(){var a=Math.min(this.points[0],this.points[2],this.points[4],this.points[6]),b=Math.min(this.points[1],this.points[3],this.points[5],this.points[7]),c=Math.max(this.points[0],this.points[2],this.points[4],this.points[6]),d=Math.max(this.points[1],this.points[3],this.points[5],this.points[7]);return{x:a,y:b,width:c-a,height:d-b}},ParaPara.CurveToSegment.prototype.toString=function(){return"C"+this.points.slice(2).map(ParaPara.fixPrecision).join(" ")};var ParaPara=ParaPara||{};ParaPara.SVG_NS="http://www.w3.org/2000/svg",ParaPara.XLINK_NS="http://www.w3.org/1999/xlink",ParaPara.init=function(a){console.assert(!a.hasChildNodes(),"Content group should be empty"),ParaPara.contentGroup=a,ParaPara.svgRoot=ParaPara.contentGroup.ownerSVGElement,ParaPara.editContent=document.createElementNS(ParaPara.SVG_NS,"g"),ParaPara.contentGroup.appendChild(ParaPara.editContent),ParaPara.drawControls=new ParaPara.DrawControls,ParaPara.eraseControls=new ParaPara.EraseControls,ParaPara.frames=new ParaPara.FrameList,ParaPara.currentStyle=new ParaPara.Style,ParaPara.history=new ParaPara.HistoryManager,ParaPara.currentTool=null},ParaPara.reset=function(){for(;ParaPara.contentGroup.hasChildNodes();)ParaPara.contentGroup.removeChild(ParaPara.contentGroup.lastChild);ParaPara.init(ParaPara.contentGroup)},ParaPara.appendFrame=function(){var a=ParaPara.frames.appendFrame();return ParaPara.currentTool.targetFrame(ParaPara.frames.getCurrentFrame()),ParaPara.history.add("insert",ParaPara.frames.getCurrentIndex()),a},ParaPara.selectFrame=function(a){var b=ParaPara.frames.selectFrame(a);return ParaPara.currentTool.targetFrame(ParaPara.frames.getCurrentFrame()),b},ParaPara.deleteFrame=function(a){ParaPara.history.add("delete",a);var b=ParaPara.frames.deleteFrame(a);return ParaPara.currentTool.targetFrame(ParaPara.frames.getCurrentFrame()),b},ParaPara.getCurrentFrame=function(a){var b=ParaPara.frames.getCurrentFrame(),a=ParaPara.frames.getCurrentIndex();return{index:a,svg:b}},ParaPara.setDrawMode=function(){return ParaPara.currentTool===ParaPara.drawControls?!1:(ParaPara.currentTool&&ParaPara.currentTool.disable(),ParaPara.drawControls.targetFrame(ParaPara.frames.getCurrentFrame()),ParaPara.currentTool=ParaPara.drawControls,!0)},ParaPara.setEraseMode=function(){return ParaPara.currentTool===ParaPara.eraseControls?!1:(ParaPara.currentTool&&ParaPara.currentTool.disable(),ParaPara.eraseControls.targetFrame(ParaPara.frames.getCurrentFrame()),ParaPara.currentTool=ParaPara.eraseControls,!0)},ParaPara.animate=function(a){ParaPara.currentTool&&ParaPara.currentTool.disable(),ParaPara.editContent.setAttribute("display","none"),ParaPara.animator=new ParaPara.Animator(a,ParaPara.contentGroup),ParaPara.animator.makeAnimation(),ParaPara.svgRoot.unpauseAnimations()},ParaPara.pauseAnimation=function(){ParaPara.animator&&ParaPara.svgRoot.pauseAnimations()},ParaPara.resumeAnimation=function(){ParaPara.animator&&ParaPara.svgRoot.unpauseAnimations()},ParaPara.removeAnimation=function(){ParaPara.animator&&(ParaPara.animator.removeAnimation(),ParaPara.animator=null,ParaPara.svgRoot.unpauseAnimations()),ParaPara.editContent.removeAttribute("display"),ParaPara.currentTool&&ParaPara.currentTool.targetFrame(ParaPara.frames.getCurrentFrame())},ParaPara.getMode=function(){return ParaPara.currentTool===ParaPara.drawControls?"draw":ParaPara.currentTool===ParaPara.eraseControls?"erase":ParaPara.animator?"animate":"draw"},ParaPara.send=function(a,b,c,d){console.assert(ParaPara.animator,"No animator found");var e=ParaPara.animator.exportAnimation(d.title,d.author);if(!e)return void c("no-animation");var f={metadata:d},g=new XMLSerializer,h=g.serializeToString(e.doc);f.svg=h,f.metadata.groundOffset=e.groundOffset,f.metadata.width=e.width,f.metadata.height=e.height,ParaPara.postRequest(a,f,b,c)},ParaPara.sendEmail=function(a,b,c,d,e){var f={address:a,locale:c};ParaPara.postRequest(b,f,d,e)},ParaPara.fixPrecision=function(a){return a.toFixed(2)},ParaPara.notifyGraphicChanged=function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("changegraphic",!0,!0,{}),ParaPara.svgRoot.dispatchEvent(a)},ParaPara.notifyHistoryChanged=function(a){var b=document.createEvent("CustomEvent");b.initCustomEvent("changehistory",!0,!0,a),ParaPara.svgRoot.dispatchEvent(b)},ParaPara.DrawControls=function(){this.linesInProgress=new Object,this.frame=null,this.mouseDownHandler=this.mouseDown.bind(this),this.mouseMoveHandler=this.mouseMove.bind(this),this.mouseUpHandler=this.mouseUp.bind(this),this.touchStartHandler=this.touchStart.bind(this),this.touchMoveHandler=this.touchMove.bind(this),this.touchEndHandler=this.touchEnd.bind(this),this.touchCancelHandler=this.touchCancel.bind(this)},ParaPara.DrawControls.prototype.targetFrame=function(a){this.frame=a,ParaPara.svgRoot.addEventListener("mousedown",this.mouseDownHandler,!1),ParaPara.svgRoot.addEventListener("mousemove",this.mouseMoveHandler,!1),ParaPara.svgRoot.addEventListener("mouseup",this.mouseUpHandler,!1),ParaPara.svgRoot.addEventListener("touchstart",this.touchStartHandler,!1),ParaPara.svgRoot.addEventListener("touchmove",this.touchMoveHandler,!1),ParaPara.svgRoot.addEventListener("touchend",this.touchEndHandler,!1),ParaPara.svgRoot.addEventListener("touchcancel",this.touchCancelHandler,!1)},ParaPara.DrawControls.prototype.disable=function(){ParaPara.svgRoot.removeEventListener("mousedown",this.mouseDownHandler,!1),ParaPara.svgRoot.removeEventListener("mousemove",this.mouseMoveHandler,!1),ParaPara.svgRoot.removeEventListener("mouseup",this.mouseUpHandler,!1),ParaPara.svgRoot.removeEventListener("touchstart",this.touchStartHandler,!1),ParaPara.svgRoot.removeEventListener("touchmove",this.touchMoveHandler,!1),ParaPara.svgRoot.removeEventListener("touchend",this.touchEndHandler,!1),ParaPara.svgRoot.removeEventListener("touchcancel",this.touchCancelHandler,!1)},ParaPara.DrawControls.prototype.mouseDown=function(a){if(a.preventDefault(),!a.button&&!this.linesInProgress.mouseLine){ParaPara.history.add("update",ParaPara.frames.getCurrentIndex());var b=this.getLocalCoords(a.clientX,a.clientY,this.frame);this.linesInProgress.mouseLine=new ParaPara.FreehandLine(b.x,b.y,this.frame)}},ParaPara.DrawControls.prototype.mouseMove=function(a){if(a.preventDefault(),this.linesInProgress.mouseLine){var b=this.getLocalCoords(a.clientX,a.clientY,this.frame);this.linesInProgress.mouseLine.addPoint(b.x,b.y)}},ParaPara.DrawControls.prototype.mouseUp=function(a){a.preventDefault(),this.linesInProgress.mouseLine&&(this.linesInProgress.mouseLine.finishLine(),delete this.linesInProgress.mouseLine,ParaPara.notifyGraphicChanged())},ParaPara.DrawControls.prototype.touchStart=function(a){a.preventDefault(),ParaPara.history.add("update",ParaPara.frames.getCurrentIndex());for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b],d=this.getLocalCoords(c.clientX,c.clientY,this.frame);this.linesInProgress[c.identifier]=new ParaPara.FreehandLine(d.x,d.y,this.frame)}},ParaPara.DrawControls.prototype.touchMove=function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b],d=this.getLocalCoords(c.clientX,c.clientY,this.frame);console.assert(this.linesInProgress[c.identifier],"Unexpected touch event"),this.linesInProgress[c.identifier].addPoint(d.x,d.y)}},ParaPara.DrawControls.prototype.touchEnd=function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b];console.assert(this.linesInProgress[c.identifier],"Unexpected touch event"),this.linesInProgress[c.identifier].finishLine(),delete this.linesInProgress[c.identifier]}ParaPara.notifyGraphicChanged()},ParaPara.DrawControls.prototype.touchCancel=function(a){a.preventDefault();for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b];console.assert(this.linesInProgress[c.identifier],"Unexpected touch event"),this.linesInProgress[c.identifier].cancelLine(),delete this.linesInProgress[c.identifier]}},ParaPara.DrawControls.prototype.getLocalCoords=function(a,b,c){var d=ParaPara.svgRoot.createSVGPoint();d.x=a,d.y=b;var e=c.parentNode.getScreenCTM();return d.matrixTransform(e.inverse())},ParaPara.FreehandLine=function(a,b,c){this.polyline=document.createElementNS(ParaPara.SVG_NS,"polyline"),ParaPara.currentStyle.styleStroke(this.polyline),c.appendChild(this.polyline);var d=ParaPara.svgRoot.createSVGPoint();d.x=a,d.y=b,this.polyline.points.appendItem(d)},ParaPara.FreehandLine.prototype.addPoint=function(a,b){console.assert(this.polyline,"Adding point to finished/cancelled line?");var c=ParaPara.svgRoot.createSVGPoint();c.x=a,c.y=b,this.polyline.points.appendItem(c)},ParaPara.FreehandLine.prototype.finishLine=function(){console.assert(this.polyline,"Line already finished/cancelled?");var a=this.createPathFromPoints(this.polyline.points);this.polyline.parentNode.appendChild(a),this.polyline.parentNode.removeChild(this.polyline),this.polyline=null},ParaPara.FreehandLine.prototype.cancelLine=function(){console.assert(this.polyline,"Line already finished/cancelled?"),this.polyline.parentNode.removeChild(this.polyline),this.polyline=null},ParaPara.FreehandLine.prototype.createPathFromPoints=function(a){if(1==a.numberOfItems)return this.createPoint(a);var b=document.createElementNS(ParaPara.SVG_NS,"path");ParaPara.currentStyle.styleStroke(b);var c=ParaPara.fixPrecision;if(2==a.numberOfItems){var d=a.getItem(0),e=a.getItem(1),f="M"+[d.x,d.y].map(c).join(" ")+"L"+[e.x,e.y].map(c).join(" ");b.setAttribute("d",f)}else{a=this.prunePoints(a);var d=a[0],f="M"+[d.x,d.y].map(c).join(" ")+"C"+this.smoothPoints(a).map(c).join(" ");b.setAttribute("d",f)}return b},ParaPara.FreehandLine.prototype.createPoint=function(a){console.assert(1===a.numberOfItems,"Expected only one point");var b=document.createElementNS(ParaPara.SVG_NS,"circle");return b.setAttribute("r",ParaPara.currentStyle.strokeWidth/2),b.setAttribute("cx",a.getItem(0).x),b.setAttribute("cy",a.getItem(0).y),ParaPara.currentStyle.styleFill(b),b},ParaPara.FreehandLine.prototype.prunePoints=function(a){for(var b=a.numberOfItems,c=20>b?10>b?1:2:3,d=[],e=0;b-c>e;e+=c){var f=a.getItem(e);d.push({x:f.x,y:f.y})}var g=a.getItem(b-1);return d.push({x:g.x,y:g.y}),d},ParaPara.FreehandLine.prototype.smoothPoints=function(a){for(var b=a[0],c=[b.x,b.y],d=a.length,e=1;d>e;e++){var f=a[e-1],g=a[e],h=a[d-1>e?e+1:e],i=Math.atan2(f.y-g.y,f.x-g.x),j=Math.atan2(h.y-g.y,h.x-g.x),k=(i+j)/2+Math.PI/2,l=ParaPara.Geometry.lineLength(g.x,g.y,h.x,h.y)/3;0>i-j&&(k+=Math.PI);var m=Math.cos(k)*l,n=Math.sin(k)*l;c[c.length]=g.x+m,c[c.length]=g.y+n,c[c.length]=g.x,c[c.length]=g.y,d-1>e&&(c[c.length]=g.x-m,c[c.length]=g.y-n)}return c},ParaPara.Style=function(){this.currentColor="black",this.strokeWidth=4,this._eraseWidth=4},ParaPara.Style.prototype.styleStroke=function(a){a.setAttribute("stroke",this.currentColor),a.setAttribute("stroke-width",this.strokeWidth),a.setAttribute("stroke-linecap","round"),a.setAttribute("fill","none"),a.setAttribute("pointer-events","none")},ParaPara.Style.prototype.styleFill=function(a){a.setAttribute("fill",this.currentColor),a.setAttribute("stroke","none"),a.setAttribute("pointer-events","none")},ParaPara.Style.prototype.__defineSetter__("eraseWidth",function(a){this._eraseWidth=a,ParaPara.eraseControls.setBrushWidth(this._eraseWidth)}),ParaPara.Style.prototype.__defineGetter__("eraseWidth",function(){return this._eraseWidth}),ParaPara.FrameList=function(){this.currentFrame=null,this.scene=ParaPara.editContent,this.appendFrame()},ParaPara.FrameList.prototype.getCurrentFrame=function(){return this.currentFrame},ParaPara.FrameList.prototype.appendFrame=function(){this.selectFrame(this.getFrameCount()-1);var a=this.getPrevFrame();a&&this.getOrMakeOldFrames().appendChild(a),this.currentFrame&&this.getOrMakePrevFrames().appendChild(this.currentFrame);var b=document.createElementNS(ParaPara.SVG_NS,"g");b.setAttribute("class","frame"),this.scene.appendChild(b),this.currentFrame=b},ParaPara.FrameList.prototype.insertFrame=function(a,b){if(!(0>a||a>=this.getFrameCount()+1)&&this.currentFrame){var c=this.getCurrentIndex();this.selectFrame(0);var d=this.getOrMakeNextFrames();0===a?(this.currentFrame.parentNode.replaceChild(b,this.currentFrame),d.insertBefore(this.currentFrame,d.firstChild),this.currentFrame=b):d.hasChildNodes()?d.insertBefore(b,d.childNodes[a-1]):d.appendChild(b),c>=a&&c++,this.selectFrame(c)}},ParaPara.FrameList.prototype.selectFrame=function(a){if(!(0>a||a>=this.getFrameCount())&&this.currentFrame){var b=this.getCurrentIndex();if(a!==b)if(b>a){var c=b-a,d=this.getOrMakeNextFrames();if(d.insertBefore(this.currentFrame,d.firstChild),this.currentFrame=null,c>1)d.insertBefore(this.getPrevFrame(),d.firstChild);else{var e=this.getPrevFrame();this.scene.insertBefore(e,this.getNextFrames()),this.currentFrame=e}for(var f=this.getOldFrames(),g=this.getPrevFrames();c>0&&f&&0!==f.childNodes.length;){var h=this.getOldFrames().lastChild;switch(c){case 1:g.appendChild(h);break;case 2:this.scene.insertBefore(h,d),this.currentFrame=h;break;default:d.insertBefore(h,d.firstChild)}c--}f&&!f.hasChildNodes()&&f.parentNode.removeChild(f),g&&!g.hasChildNodes()&&g.parentNode.removeChild(g)}else{var c=a-b,e=this.getPrevFrame();e&&this.getOrMakeOldFrames().appendChild(e),c>1?this.getOrMakeOldFrames().appendChild(this.currentFrame):this.getOrMakePrevFrames().appendChild(this.currentFrame);for(var d=this.getNextFrames();c>0&&d&&0!==d.childNodes.length;){var h=this.getNextFrames().firstChild;switch(c){case 1:this.scene.insertBefore(h,d),this.currentFrame=h;break;case 2:this.getOrMakePrevFrames().appendChild(h);break;default:this.getOrMakeOldFrames().appendChild(h)}c--}d&&!d.hasChildNodes()&&d.parentNode.removeChild(d)}}},ParaPara.FrameList.prototype.deleteFrame=function(a){if(!(0>a||a>=this.getFrameCount())&&this.currentFrame){var b=this.getCurrentIndex();if(this.selectFrame(0),0===a){this.currentFrame.parentNode.removeChild(this.currentFrame),this.currentFrame=null;var c=this.getNextFrames();if(c){var d=c.firstChild;this.scene.insertBefore(d,c),this.currentFrame=d}else this.appendFrame()}else{var c=this.getNextFrames();c.removeChild(c.childNodes[a-1])}var c=this.getNextFrames();c&&!c.hasChildNodes()&&c.parentNode.removeChild(c),this.selectFrame(Math.min(b,this.getFrameCount()-1))}},ParaPara.FrameList.prototype.getFrames=function(){return this.scene.getElementsByClassName("frame")},ParaPara.FrameList.prototype.getFrame=function(a){return 0>a||a>=this.getFrameCount()?void 0:this.getFrames()[a]},ParaPara.FrameList.prototype.getCurrentIndex=function(){return this.getOldFrames()?this.getOldFrames().childNodes.length+1:this.getPrevFrame()?1:0},ParaPara.FrameList.prototype.getFrameCount=function(){return this.getFrames().length},ParaPara.FrameList.prototype.getPrevFrame=function(){var a=this.getPrevFrames();return a?a.lastChild:null},ParaPara.FrameList.prototype.getPrevFrames=function(){return this._getPrevFrames(!1)},ParaPara.FrameList.prototype.getOrMakePrevFrames=function(){return this._getPrevFrames(!0)},ParaPara.FrameList.prototype._getPrevFrames=function(a){return this._getOrMakeGroup(this.scene,!0,"prevFrames",a)},ParaPara.FrameList.prototype.getOldFrames=function(){var a=this.getPrevFrames();return a?this._getOrMakeGroup(a,!0,"oldFrames",!1):null},ParaPara.FrameList.prototype.getOrMakeOldFrames=function(){var a=this.getOrMakePrevFrames();return this._getOrMakeGroup(a,!0,"oldFrames",!0)},ParaPara.FrameList.prototype.getNextFrames=function(){return this._getNextFrames(!1)},ParaPara.FrameList.prototype.getOrMakeNextFrames=function(){return this._getNextFrames(!0)},ParaPara.FrameList.prototype._getNextFrames=function(a){return this._getOrMakeGroup(this.scene,!1,"nextFrames",a)},ParaPara.FrameList.prototype._getOrMakeGroup=function(a,b,c,d){var e=b?a.firstChild:a.lastChild;if(e&&e.classList.contains(c))return e;if(!d)return null;var f=document.createElementNS(ParaPara.SVG_NS,"g");return f.setAttribute("class",c),a.insertBefore(f,b?a.firstChild:null)},ParaPara.Animator=function(a,b){this.dur=1/a,this.animation=document.createElementNS(ParaPara.SVG_NS,"g"),b.appendChild(this.animation)},ParaPara.Animator.prototype.makeAnimation=function(){for(var a=ParaPara.frames.getFrames(),b="",c=0;c<a.length;++c){var d=a[c];d.hasChildNodes()&&this.animation.appendChild(d.cloneNode(!0))}if(a=this.animation.childNodes,!(a.length<2)){for(var c=0;c<a.length;++c){var d=a[c];d.removeAttribute("class"),d.setAttribute("visibility","hidden");var e=document.createElementNS(ParaPara.SVG_NS,"set");e.setAttribute("attributeName","visibility"),e.setAttribute("to","visible"),e.setAttribute("dur",this.dur+"s");var f="anim"+ParaPara.Utils.uuid();
e.setAttribute("id",f),b&&e.setAttribute("begin",b+".end"),d.appendChild(e),b=f}var g=a[0].getElementsByTagName("set")[0];g.setAttribute("begin","0; "+b+".end"),ParaPara.svgRoot.setCurrentTime(0)}},ParaPara.Animator.prototype.removeAnimation=function(){this.animation&&this.animation.parentNode&&this.animation.parentNode.removeChild(this.animation),this.animation=null},ParaPara.Animator.prototype.exportAnimation=function(a,b){var c=document.implementation.createDocument(ParaPara.SVG_NS,"svg",null),d=c.documentElement;if(d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.pauseAnimations(),a){var e=c.createElementNS(ParaPara.SVG_NS,"title");e.appendChild(c.createTextNode(a)),d.appendChild(e)}if(b){var f=c.createElementNS(ParaPara.SVG_NS,"desc"),g=b+"さんより";f.appendChild(c.createTextNode(g)),d.appendChild(f)}var h=minY=Number.POSITIVE_INFINITY,i=maxY=Number.NEGATIVE_INFINITY,j=this.animation.childNodes;if(!j.length)return null;for(var k=0;k<j.length;++k){var l=j[k];console.assert(l.childNodes.length,"Empty frames should have already been dropped");var m=this.getDecoratedBbox(l);h=Math.floor(Math.min(h,m.x)),i=Math.ceil(Math.max(i,m.x+m.width)),minY=Math.floor(Math.min(minY,m.y)),maxY=Math.ceil(Math.max(maxY,m.y+m.height));var n=c.importNode(l,!0);n.removeAttribute("style"),d.appendChild(n)}var o=ParaPara.svgRoot.getAttribute("viewBox");console.assert(o,"No parent viewBox"),o=o.trim().split(" ").map(parseFloat),h=Math.max(h,o[0]),i=Math.min(i,o[0]+o[2]),minY=Math.max(minY,o[1]),maxY=Math.min(maxY,o[1]+o[3]),d.setAttribute("viewBox",[h,minY,i-h,maxY-minY].join(" "));var p=(o[3]-maxY)/(o[3]-o[1]);return d.setAttribute("data-ground-offset",p.toFixed(3)),{doc:c,groundOffset:p,width:i-h,height:maxY-minY}},ParaPara.Animator.prototype.getDecoratedBbox=function(a){for(var b=a.getBBox(),c=0,d=a.querySelectorAll("path"),e=0;e<d.length;e++){var f=parseInt(window.getComputedStyle(d[e]).strokeWidth);c=Math.max(c,f)}return b.x-=c/2,b.y-=c/2,b.width+=c,b.height+=c,b},ParaPara.Animator.prototype.setSpeed=function(a){this.dur=1/a;for(var b=this.animation.getElementsByTagName("set"),c=0;c<b.length;++c){var d=b[c];d.setAttribute("dur",this.dur+"s")}},ParaPara.Utils={},ParaPara.Utils.uuid=function(){return UUID.generate().replace(/-/g,"")},ParaPara.HistoryManager=function(){this.MAX_STACK_SIZE=50,this.undoStack=[],this.redoStack=[]},ParaPara.HistoryManager.prototype["do"]=function(a){a.svg=a.svg.cloneNode(!0);var b=a.index;switch(a.cmd){case"update":ParaPara.frames.selectFrame(a.index),ParaPara.editContent.replaceChild(a.svg,ParaPara.frames.getCurrentFrame()),ParaPara.frames.currentFrame=a.svg;break;case"insert":ParaPara.frames.insertFrame(a.index,a.svg);break;case"delete":ParaPara.frames.deleteFrame(a.index),b=ParaPara.frames.getCurrentIndex()}ParaPara.selectFrame(b),ParaPara.notifyHistoryChanged(a)},ParaPara.HistoryManager.prototype.undo=function(){if(0!==this.undoStack.length){var a=this.undoStack.pop(),b=a.cmd;switch(b){case"update":this.add("update",a.index,!1),this.redoStack.push(this.undoStack.pop());break;case"insert":b="delete",this.redoStack.push(a);break;case"delete":b="insert",this.redoStack.push(a)}this["do"]({cmd:b,index:a.index,svg:a.svg})}},ParaPara.HistoryManager.prototype.redo=function(){if(0!==this.redoStack.length){var a=this.redoStack.pop();switch(a.cmd){case"update":this.add("update",a.index,!1);break;case"insert":case"delete":this.undoStack.push(a)}this["do"](a)}},ParaPara.HistoryManager.prototype.add=function(a,b,c){this.undoStack.length>=this.MAX_STACK_SIZE&&this.undoStack.shift(),this.undoStack.push({cmd:a,index:b,svg:ParaPara.frames.getFrame(b).cloneNode(!0)}),c!==!1&&(this.redoStack=[])},"undefined"==typeof document||"classList"in document.createElement("a")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","g")||!function(a){"use strict";var b="http://www.w3.org/2000/svg",c="classList",d="prototype",e=Object,f=String[d].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[d].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b="undefined"!=typeof a.className.baseVal?a.className.baseVal:a.className,c=f.call(b),d=c?c.split(/\s+/):[],e=0,g=d.length;g>e;e++)this.push(d[e]);this._updateClassName=function(){"undefined"!=typeof a.className.baseVal?a.className.baseVal=this.toString():a.className=this.toString()}},k=j[d]=[],l=function(){return new j(this)},m=function(a){if(e.defineProperty){var b={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(a[d],c,b)}catch(f){-2146823252===f.number&&(b.enumerable=!1,e.defineProperty(a[d],c,b))}}else e[d].__defineGetter__&&elemCtrl[d].__defineGetter__(c,l)},n=function(a,c){"classList"in a.createElement("a")||m(c.HTMLElement||c.Element),"classList"in a.createElementNS(b,"g")||m(c.SVGElement)},o=function(a){if(a.contentDocument&&"complete"==a.contentDocument.readyState){var b=a.contentWindow||a.contentDocument.defaultView;n(a.contentDocument,b)}},p=function(){for(var a=document.getElementsByTagName("object"),b=0;b<a.length;++b)o(a[b])},q=function(){p(),document.addEventListener("DOMNodeInserted",r,!0)},r=function(a){o(a.srcElement),a.srcElement.addEventListener("load",p,!0)};h[d]=Error[d],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(a){a+="",-1===i(this,a)&&(this.push(a),this._updateClassName())},k.remove=function(a){a+="";var b=i(this,a);-1!==b&&(this.splice(b,1),this._updateClassName())},k.toggle=function(a){a+="",-1===i(this,a)?this.add(a):this.remove(a)},k.toString=function(){return this.join(" ")},n(document,a),"complete"!=document.readyState?(document.addEventListener("DOMContentLoaded",q,!0),window.addEventListener("load",p,!0)):q()}(self),UUID.generate=function(){var a=UUID._gri,b=UUID._ha;return b(a(32),8)+"-"+b(a(16),4)+"-"+b(16384|a(12),4)+"-"+b(32768|a(14),4)+"-"+b(a(48),12)},UUID._gri=function(a){return 0>a?NaN:30>=a?0|Math.random()*(1<<a):53>=a?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<a-30))*(1<<30):NaN},UUID._ha=function(a,b){for(var c=a.toString(16),d=b-c.length,e="0";d>0;d>>>=1,e+=e)1&d&&(c=e+c);return c};var ParaPara=ParaPara||{};ParaPara.XHR_TIMEOUT=8e3,ParaPara.postRequest=function(a,b,c,d){var e=JSON.stringify(b),f=new XMLHttpRequest;f.open("POST",a,!0),f.setRequestHeader("Content-Type","application/json"),f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status||0==f.status)try{var a=JSON.parse(f.responseText);a.error_key?d(a.error_key,a.error_detail):c(JSON.parse(f.responseText))}catch(b){if(!(b instanceof SyntaxError))throw b;console.debug("Error sending to server, could not parse response: "+f.responseText),d("server-fail")}else d("no-access")};try{f.send(e)}catch(g){return console.debug(g),void d("send-fail")}window.setTimeout(function(){0!=f.readyState&&4!=f.readyState&&(f.abort(),d("timeout"))},ParaPara.XHR_TIMEOUT),ParaPara.abortRequest=function(){0!=f.readyState&&4!=f.readyState&&f.abort()}},ParaPara.abortRequest=function(){};